{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the ADGANHE Platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "credits": {
            "type": "number",
            "description": "The user's available credits in BRL."
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time the user registered.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "The date and time of the user's last login.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "registrationDate",
        "credits"
      ]
    },
    "Transaction": {
      "title": "Transaction",
      "type": "object",
      "description": "Represents a credit or debit transaction in a user's account.",
      "properties": {
        "amount": {
          "type": "number",
          "description": "The transaction amount. Positive for credits, negative for debits."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the transaction."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the transaction occurred."
        }
      },
      "required": ["amount", "description", "createdAt"]
    },
    "WithdrawalRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Withdrawal Request",
      "type": "object",
      "description": "Represents a user's request to withdraw funds.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user making the request."
        },
        "userName": {
          "type": "string",
          "description": "The name of the user."
        },
        "userEmail": {
          "type": "string",
          "description": "The email of the user.",
          "format": "email"
        },
        "amount": {
          "type": "number",
          "description": "The amount to withdraw in BRL."
        },
        "pixKey": {
          "type": "string",
          "description": "The PIX key for the transfer."
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "completed",
            "rejected"
          ],
          "description": "The current status of the request."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the request was created."
        },
        "processedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the request was processed."
        }
      },
      "required": [
        "userId",
        "userName",
        "userEmail",
        "amount",
        "pixKey",
        "status",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The 'userId' parameter corresponds to the Firebase Authentication UID. Access is restricted to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Authentication UID."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": { "$ref": "#/backend/entities/Transaction" },
          "description": "Stores all credit/debit transactions for a specific user.",
           "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/withdrawalRequests/{requestId}",
        "definition": {
          "entityName": "WithdrawalRequest",
          "schema": {
            "$ref": "#/backend/entities/WithdrawalRequest"
          },
          "description": "Stores all user withdrawal requests. Accessed by admins to process them.",
          "params": [
            {
              "name": "requestId",
              "description": "The unique identifier for the withdrawal request."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support user authentication and management, a crucial foundation for the ADGANHE platform. The structure focuses on secure and scalable data storage, optimized for the platform's key features, including dynamic indexing, ad network integration, and personalized ad recommendations. By structuring the data around users, the system can efficiently manage user profiles, authentication data, and any user-specific data added in the future.\n\n**Authorization Independence:** The current data structure focuses on user-specific data, which naturally provides authorization independence. Since the user document only contains user-related information, access control is straightforward and based on the `request.auth.uid` matching the `userId` in the path.\n\n**QAPs (Rules are not Filters):** The segregation of user data into individual documents under the `/users/{userId}` path ensures that list operations can be securely managed. Rules can efficiently restrict access to only the authenticated user's data without needing to filter based on document content."
  }
}
